steps:
  # Leap doesn't install mkcert on Linux and asks users to install it manually.
  - bash: |
      set -x
      sudo apt update && \
      sudo apt install libnss3-tools -y && \
      sudo apt install mkcert -y && \
      mkcert -install
    condition: eq(variables['Agent.OS'], 'Linux')
    displayName: "Linux: Install mkcert"

  # Leap doesn't install mkcert on macOS and asks users to install it manually.
  - bash: |
      set -x
      brew install mkcert && \
      mkcert -install
    condition: eq(variables['Agent.OS'], 'Darwin')
    displayName: "macOS: Install mkcert"

  # Leap does install mkcert automatically on Windows but it is an interactive process
  # "mkcert -install" opens a confirmation window. We have to install it manually on CI.
  - pwsh: |
      choco install mkcert --verbose --yes && `
      mkcert dummy_arg_to_trigger_certificate_authority_creation && `
      certutil -addstore "Root" (Join-Path (mkcert -CAROOT) "rootCA.pem")
    condition: eq(variables['Agent.OS'], 'Windows_NT')
    displayName: "Windows: Install mkcert"
